{% comment %}
  ============================================================================
  Blog Preview Component (Visual Only)
  ============================================================================

  @file        _includes/block--blog-preview.html
  @description Homepage blog preview showing 3 latest/recently updated articles
               with images, meta info, engagement stats, and CTA to blog page.

  @version     1.0.0
  @date        2025-11-22
  @author      jualkayudolkengelam
  @copyright   2024-2025 Kayu Dolken Gelam - Amirudin Abdul Karim
  @license     All rights reserved

  Features:
  ---------
  - Shows 3 most recent or recently updated articles
  - Sorts by last_modified_at (fresh content first)
  - Card layout with responsive grid (3 columns on large, 2 on medium)
  - Post metadata (date, author, categories)
  - Engagement stats (likes, comments, shares)
  - Featured images with WebP support
  - CTA button to view all articles

  Schema:
  -------
  Schema for this block is in: _includes/schema--blog-preview.html
  Call from page with: {% include schema--blog-preview.html %}

  Parameters:
  -----------
  - title: Custom section heading (default: "Artikel & Tips Terbaru")
  - subtitle: Custom subtitle (default: "Informasi seputar kayu dolken gelam dan penggunaannya")
  - limit: Number of posts to show (default: 3)

  Usage:
  ------
  {% include reusable/block--blog-preview.html %}

  {% include reusable/block--blog-preview.html title="Berita Terbaru" limit=6 %}

  Used in:
  --------
  - index.html (homepage blog preview section)

  ============================================================================
{% endcomment %}

{% assign preview_title = include.title | default: "Artikel & Tips Terbaru" %}
{% assign preview_subtitle = include.subtitle | default: "Informasi seputar kayu dolken gelam dan penggunaannya" %}
{% assign preview_limit = include.limit | default: 3 %}

{% comment %}Combine all posts from both collections{% endcomment %}
{% assign all_posts = site.posts | concat: site.post_with_city %}

{% if all_posts.size > 0 %}
<div class="container">
  <div class="text-center mb-5">
    <span class="badge bg-wood text-white mb-2 px-3 py-2">
      <i class="bi bi-journal-richtext me-1"></i>Blog
    </span>
    <h2 class="display-6 fw-bold text-wood mb-3">{{ preview_title }}</h2>
    <p class="lead text-muted">{{ preview_subtitle }}</p>
  </div>

  {% comment %}
  Sort by last_modified_at to show recently updated posts first
  {% endcomment %}
  {% assign posts_with_modified = all_posts | where_exp: "post", "post.last_modified_at" | sort: "last_modified_at" | reverse %}
  {% assign posts_without_modified = all_posts | where_exp: "post", "post.last_modified_at == nil" | sort: "date" | reverse %}
  {% assign sorted_posts = posts_with_modified | concat: posts_without_modified %}

  <div class="row g-4">
    {% for post in sorted_posts limit:preview_limit %}
    <div class="col-md-6 col-lg-4">
      <div class="card blog-card border-0 shadow-sm h-100">
        {% if post.image %}
        <picture>
          <source srcset="{{ post.image | replace: '.jpeg', '.webp' | relative_url }}" type="image/webp">
          <img src="{{ post.image | relative_url }}" class="card-img-top" alt="{{ post.title }}" loading="lazy" style="height: 200px; object-fit: cover;">
        </picture>
        {% else %}
        <div class="bg-wood d-flex align-items-center justify-content-center" style="height: 200px;">
          <i class="bi bi-file-text text-white fs-1"></i>
        </div>
        {% endif %}
        <div class="card-body d-flex flex-column">
          <!-- Categories & Date -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            {% if post.categories %}
            <div>
              {% for category in post.categories limit:1 %}
              <span class="badge bg-secondary text-white small">{{ category }}</span>
              {% endfor %}
            </div>
            {% endif %}
            <small class="text-muted">
              <i class="bi bi-calendar3 me-1"></i>{{ post.date | date: "%d %b %Y" }}
            </small>
          </div>

          <h5 class="card-title fw-bold">
            <a href="{{ post.url | relative_url }}" class="text-decoration-none text-dark stretched-link">{{ post.title }}</a>
          </h5>
          <p class="card-text text-muted small flex-grow-1">{{ post.description | default: post.excerpt | strip_html | truncate: 100 }}</p>

          <!-- Engagement Stats -->
          {% if post.like_count or post.comment_count %}
          <div class="d-flex gap-3 small text-muted mb-2">
            {% if post.like_count %}
            <span><i class="bi bi-heart-fill text-danger me-1"></i>{{ post.like_count }}</span>
            {% endif %}
            {% if post.comment_count %}
            <span><i class="bi bi-chat-fill text-primary me-1"></i>{{ post.comment_count }}</span>
            {% endif %}
          </div>
          {% endif %}

          <div class="mt-auto">
            <span class="text-wood small fw-bold">
              Baca Selengkapnya <i class="bi bi-arrow-right ms-1"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="text-center mt-5">
    <a href="{{ '/blog' | relative_url }}" class="btn btn-wood btn-lg">
      Lihat Semua Artikel <i class="bi bi-arrow-right ms-2"></i>
    </a>
  </div>
</div>
{% endif %}
